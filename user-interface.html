<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="UTF-8">
  <title>Event Planner</title>
  <!--semantic ui-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
  <!--fomantic ui-->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.4/dist/semantic.min.css">
  <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.4/dist/semantic.min.js"></script>
  <!--Moment Timezone-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.0/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.13/moment-timezone.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.13/moment-timezone-with-data-2012-2022.min.js"></script>
  <!--Mapquest Developer-->
  <script src="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.js"></script>
  <link type="text/css" rel="stylesheet" href="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.css"/>

  <!--Javascript-->
  <script src="fileGenerator.js"></script>
</head>


<body>

<div class="ui teal inverted segment"><h1 class="ui left aligned header">Event Planner</h1></div>
<div class="ui container">
  <div class="ui raised very padded segment">
    <form class="ui form">
      <div class="field">
        <div class="ui grid">
          <div class="twelve wide column">
            <div class="ui transparent massive input">
              <input type="text" id="event-title" placeholder="Event Title" style="text-align: center; font-size: 32px;">
            </div>
          </div>
          <div class="two wide column">
            <label>Visibility</label>
            <select class="ui dropdown" id="event-visibility">
              <option value="PUBLIC">Public</option><option value="PRIVATE">Private</option><option value="CONFIDENTIAL">Confidential</option>
            </select>
          </div>
          <div class="two wide column">
            <label>Priority</label>
            <select class="ui dropdown" id="event-priority">
              <option style="display: none;" disabled selected></option>
              <option value="9">Low</option>
              <option value="5">Medium</option>
              <option value="1">High</option>
            </select>
          </div>
        </div>
      </div>
      <div class="ui section divider" style="padding-top: 10px; padding-bottom: 10px"></div>
      <div class="field">
        <div class="ui grid">
          <div class="four wide column">
            <label>Start</label>
            <div class="ui calendar" id="event-start">
              <div class="ui input left icon">
                <i class="calendar icon"></i><input type="text" placeholder="Date/Time">
              </div>
            </div>
          </div>
          <div class="four wide column">
            <label>End</label>
            <div class="ui calendar" id="event-end" >
              <div class="ui input left icon">
                <i class="calendar icon"></i><input type="text" placeholder="Date/Time">
              </div>
            </div>
          </div>
          <div class="three wide column"><label>Timezone</label><select class="ui dropdown" id="timezone-dropdown"></select></div>
        </div>
      </div>
      <div class="ui section divider" style="padding-top: 10px; padding-bottom: 10px"></div>
      <div class="field">
        <label>Venue</label><input type="text" id="event-venue" placeholder="Auditorium">
      </div>
      <div class="field">
        <label>Address</label>
        <div class="ui accordion">
          <div class="title">
            <div class="ui grid">
              <div class="fifteen wide column">
                <input type="text" id="event-address" placeholder="Click button on right" disabled>
              </div>
              <div class="one wide column">
                <div class="ui icon large circular button"><i class="angle double down icon"></i></div>
              </div>
            </div>
          </div>
          <div class="content">
            <div class="ui padded basic segment">
              <div class="ui form">
                <div class="field">
                  <div class="ui grid">
                    <div class="fourteen wide column">
                      <label>Street Number and Name</label><input id="address-street" type="text" placeholder="1234 Abcd Avenue">
                    </div>
                    <div class="two wide column">
                      <label>Apt/Suite/Unit</label><input type="text" placeholder="1601" id="address-apt">
                    </div>
                  </div>
                </div>
                <div class="ui field">
                  <div class="ui grid">
                    <div class="ten wide column">
                      <label>City</label><input type="text" id="address-city" placeholder="Honolulu">
                    </div>
                    <div class="four wide column">
                      <label>State</label><select class="ui dropdown" id="address-state"> </select>
                    </div>
                    <div class="two wide column">
                      <label>Zip Code</label><input id="address-zip" type="text" placeholder="12345">
                    </div>
                  </div>
                </div>
                <div class="small ui button" onclick="addressDisplay()">Confirm</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="ui section divider" style="padding-top: 10px; padding-bottom: 10px"></div>
      <div class="field">
        <label>Description:</label>
        <textarea id="event-description"></textarea>
      </div>
      <button class="large ui teal button" onclick="checkInput()" type="button"><i class="download icon"></i>
        Generate
      </button>
    </form>
  </div>
</div>

<script>
  $('.ui.accordion').accordion({ selector: { trigger: '.title .ui.button' } });
  $('.ui.calendar').calendar();

  var sdate = null;
  var edate = null;

  $('#event-start').calendar({
    onChange: function (date, text) {
      sdate = text;
    },
  });

  $('#event-end').calendar({
    onChange: function (date, text) {
      edate = text;
    },
  });

  var timezoneArray = moment.tz.names();
  var timezoneItems = "";
  for (var i = 0; i < timezoneArray.length; i++) {
    if (timezoneArray[i] == "HST") {
      timezoneItems += "<option value='" + timezoneArray[i] + "' selected>" + timezoneArray[i] + "</option>";
    } else {
      timezoneItems += "<option value='" + timezoneArray[i] + "'>" + timezoneArray[i] + "</option>";
    }
  }
  document.getElementById("timezone-dropdown").innerHTML = timezoneItems;

  function addressDisplay() {
    var state =
        document.getElementById('address-state')[document.getElementById('address-state').selectedIndex].value;
    var addressString = document.getElementById("address-street").value + ", "
        + document.getElementById("address-apt").value + ", "
        + document.getElementById("address-city").value + ", "
        + state + ", "
        + document.getElementById("address-zip").value;
    document.getElementById("event-address").value = addressString;
    $('.ui.accordion').accordion('close', 0);
  }



  function checkInput() {

    var valid = true;
    var title = document.getElementById("event-title").value;
    var venue = document.getElementById("event-venue").value;
    var address = document.getElementById("event-address").value;
    var description = document.getElementById("event-description").value;
    var street = document.getElementById("address-street").value;
    var state = document.getElementById('address-state')[document.getElementById('address-state').selectedIndex].value;
    var city = document.getElementById("address-city").value;
    var zip = document.getElementById("address-zip").value;

    // code to make start date into a string for .ics file
    var startDate = new Date(sdate).toISOString();
    var finalSDate = startDate.substr(0,4) + startDate.substr(5,2) + startDate.substr(8,2) + 'T'  + startDate.substr(11,2)
        + startDate.substr(14,2) + startDate.substr(17,2);
    var compareStart = new Date(sdate).getTime();

    // code to make start date into a string for .ics file
    var endDate = new Date(edate).toISOString();
    var finalEDate = endDate.substr(0,4) + endDate.substr(5,2) + endDate.substr(8,2) + 'T'  + endDate.substr(11,2)
        + endDate.substr(14,2) + endDate.substr(17,2);
    var compareEnd = new Date(edate).getTime();
    var compareNow = new Date().getTime();

    // console.log('info for start date:')
    // console.log(sdate);
    // console.log(startDate);
    // console.log(finalSDate);
    //
    // console.log('info for end date:')
    // console.log(edate);
    // console.log(endDate);
    // console.log(finalEDate);

    var lat = null;
    var lng = null;

    L.mapquest.key = 'OjiA3XDVG7onzudvU6ZVAcIKzAx1cPng';
    L.mapquest.geocoding().geocode({
      street: street,
      city: city,
      state: state,
      postalCode: zip
    }, getAddress);
    function getAddress(error, response) {
      var location = response.results[0].locations[0];
      var latLng = location.displayLatLng;
      this.lat = latLng.lat;
      this.lng = latLng.lng;
      console.log(latLng);

      //check parameters.
      if(sdate === null | edate === null) {
        valid = false;
        alert('There must be a start and end to the event');
      } else if(compareStart > compareEnd){
        valid = false;
        alert('Start time must be before end time');
      } else if(compareStart < compareNow){
        valid = false;
        alert('Event cannot start in the past');
      } else if(title === ''){
        valid = false;
        alert('There must be a title');
      } else if(venue === ''){
        valid = false;
        alert('There must be a venue');
      } else if(address === ''){
        valid = false;
        alert('There must be a address \n*pleae make sure to confirm address*');
      } else if(state === '' | city === '' | zip === '' | street === ''){
        valid = false;
        alert('Please make sure that all fields of the address are completed');
      } else if(this.lat === null | this.lng === null){
        valid = false;
        alert('Invalid address was input. Please make sure that input is correct.');
      } else if(description === ''){
        valid = false;
        alert('There must be a description');
      } else if (valid === true) {
        generateFile('calendar.ics', title, finalSDate, finalEDate, address, description, this.lat, this.lng);
      }
    }

  }

  var stateItems =
      "<option value=\"AL\">Alabama</option>" +
      "<option value=\"AK\">Alaska</option>" +
      "<option value=\"AZ\">Arizona</option>" +
      "<option value=\"AR\">Arkansas</option>" +
      "<option value=\"CA\">California</option>" +
      "<option value=\"CO\">Colorado</option>" +
      "<option value=\"CT\">Connecticut</option>" +
      "<option value=\"DE\">Delaware</option>" +
      "<option value=\"DC\">District Of Columbia</option>" +
      "<option value=\"FL\">Florida</option>" +
      "<option value=\"GA\">Georgia</option>" +
      "<option value=\"HI\" selected>Hawaii</option>" +
      "<option value=\"ID\">Idaho</option>" +
      "<option value=\"IL\">Illinois</option>" +
      "<option value=\"IN\">Indiana</option>" +
      "<option value=\"IA\">Iowa</option>" +
      "<option value=\"KS\">Kansas</option>" +
      "<option value=\"KY\">Kentucky</option>" +
      "<option value=\"LA\">Louisiana</option>" +
      "<option value=\"ME\">Maine</option>" +
      "<option value=\"MD\">Maryland</option>" +
      "<option value=\"MA\">Massachusetts</option>" +
      "<option value=\"MI\">Michigan</option>" +
      "<option value=\"MN\">Minnesota</option>" +
      "<option value=\"MS\">Mississippi</option>" +
      "<option value=\"MO\">Missouri</option>" +
      "<option value=\"MT\">Montana</option>" +
      "<option value=\"NE\">Nebraska</option>" +
      "<option value=\"NV\">Nevada</option>" +
      "<option value=\"NH\">New Hampshire</option>" +
      "<option value=\"NJ\">New Jersey</option>" +
      "<option value=\"NM\">New Mexico</option>" +
      "<option value=\"NY\">New York</option>" +
      "<option value=\"NC\">North Carolina</option>" +
      "<option value=\"ND\">North Dakota</option>" +
      "<option value=\"OH\">Ohio</option>" +
      "<option value=\"OK\">Oklahoma</option>" +
      "<option value=\"OR\">Oregon</option>" +
      "<option value=\"PA\">Pennsylvania</option>" +
      "<option value=\"RI\">Rhode Island</option>" +
      "<option value=\"SC\">South Carolina</option>" +
      "<option value=\"SD\">South Dakota</option>" +
      "<option value=\"TN\">Tennessee</option>" +
      "<option value=\"TX\">Texas</option>" +
      "<option value=\"UT\">Utah</option>" +
      "<option value=\"VT\">Vermont</option>" +
      "<option value=\"VA\">Virginia</option>" +
      "<option value=\"WA\">Washington</option>" +
      "<option value=\"WV\">West Virginia</option>" +
      "<option value=\"WI\">Wisconsin</option>" +
      "<option value=\"WY\">Wyoming</option>";
  document.getElementById("address-state").innerHTML = stateItems;
</script>

</body>

</html>
